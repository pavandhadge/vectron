syntax = "proto3";

package vectron.worker.v1;
option go_package = "github.com/pavandhadge/vectron/apigateway/proto/worker";

// The worker service definition.
service WorkerService{
  // Vector operations
  rpc StoreVector(StoreVectorRequest) returns (StoreVectorResponse) {}
  rpc GetVector(GetVectorRequest) returns (GetVectorResponse) {}
  rpc DeleteVector(DeleteVectorRequest) returns (DeleteVectorResponse) {}
  rpc Search(SearchRequest) returns (SearchResponse) {}

  // Key-value operations
  rpc Put(PutRequest) returns (PutResponse) {}
  rpc Get(GetRequest) returns (GetResponse) {}
  rpc Delete(DeleteRequest) returns (DeleteResponse) {}

  // Control/Admin operations
  rpc Status(StatusRequest) returns (StatusResponse) {}
  rpc Flush(FlushRequest) returns (FlushResponse) {}
}

// Vector messages
message Vector {
  string id = 1;
  repeated float vector = 2;
  bytes metadata = 3;
}

message StoreVectorRequest {
  uint64 shard_id = 1;
  Vector vector = 2;
}

message StoreVectorResponse {}

message GetVectorRequest {
  uint64 shard_id = 1;
  string id = 2;
}

message GetVectorResponse {
  Vector vector = 1;
}

message DeleteVectorRequest {
  uint64 shard_id = 1;
  string id = 2;
}

message DeleteVectorResponse {}

message SearchRequest {
  uint64 shard_id = 1;
  repeated float vector = 2;
  int32 k = 3;
  bool brute_force = 4;
}

message SearchResponse {
  repeated string ids = 1;
}

// Key-value messages
message KeyValuePair {
  bytes key = 1;
  bytes value = 2;
}

message PutRequest {
  uint64 shard_id = 1;
  KeyValuePair kv = 2;
}

message PutResponse {}

message GetRequest {
  uint64 shard_id = 1;
  bytes key = 2;
}

message GetResponse {
  KeyValuePair kv = 1;
}

message DeleteRequest {
  uint64 shard_id = 1;
  bytes key = 2;
}

message DeleteResponse {}

// Control/Admin messages
message StatusRequest {
  uint64 shard_id = 1;
}

message StatusResponse {
  string status = 1;
}

message FlushRequest {
  uint64 shard_id = 1;
}

message FlushResponse {}
